<!DOCTYPE html>
<html>
  <head>
    <script src="../packages/jspsych/dist/index.browser.js"></script>
    <script src="../packages/plugin-html-keyboard-response/dist/index.browser.js"></script>
    <script src="../packages/plugin-image-keyboard-response/dist/index.browser.js"></script>
    <script src="../packages/plugin-preload/dist/index.browser.js"></script>
    <link rel="stylesheet" href="../packages/jspsych/css/jspsych.css">
  </head>
  <body></body>
  <script>

    var jsPsych = initJsPsych({
      on_finish: function() {
        // jsPsych.data.get().localSave('csv', 'timeline-variables.csv');
        jsPsych.metadata.displayMetadata(); // documentation code
        // jsPsych.data.displayData();
      },
      default_iti: 250
    });

    // manually preload the image files, since they are passed to the image-keyboard-response stimulus parameter
    // through timeline variables, and therefore cannot be automatically preloaded
    var images = ['img/happy_face_1.jpg', 'img/happy_face_2.jpg', 'img/happy_face_3.jpg'];
    var preload = {
      type: jsPsychPreload,
      images: images
    };

    var timeline_variables = [
      { v1: 'img/happy_face_1.jpg', v2: 'Ann'},
      { v1: 'img/happy_face_2.jpg', v2: 'Jackson'},
      { v1: 'img/happy_face_3.jpg', v2: 'Riley' }
    ];

    var node = {
      timeline_variables: timeline_variables,
      timeline: [
        {
          type: jsPsychHtmlKeyboardResponse,
          choices: "NO_KEYS",
          stimulus: "<p style='text-align:center; font-size:80px;'>+</p>",
          trial_duration: 500,
          description: ""
        },
        {
          type: jsPsychImageKeyboardResponse,
          choices: ['y','n'], 
          stimulus: jsPsych.timelineVariable('v1'),
          prompt: function() { 
            return '<p>Have you seen '+jsPsych.timelineVariable('v2', true)+ ' before? Press "y" or "n".</p>' 
          },
          stimulus_width: 300,
        }
      ],
      randomize_order: true,
      repetitions: 2
    };

    // beginning of code to document

    const author1 = {
      name: "John Cena"
    };
    jsPsych.metadata.setAuthor(author1);

    const author2 = {
      name: "Wreck-it-Ralph",
      identifier: "www.google.com"
    };
    jsPsych.metadata.setAuthor(author2);

    const prop_value_var = {
      type: "PropertyValue",
      name: "Response Time (rt)",
      description: "Time participant takes to respond to a stimulus",
      value: "numeric",
      minValue: 0,
      maxValue: 10000
    };
    jsPsych.metadata.setVariable(prop_value_var);

    const stimulus_var = { 
      type: "PropertyValue",
      name: "Stimulus",
      description: {
        "<p style='text-align:center; font-size:80px;'>+</p>": "This is a fixation screen that helps concentrate focus",
        "[\"img/happy_face_1.jpg\", \"img/happy_face_2.jpg\",\"img/happy_face_3.jpg\"]" : "These are different pictures of peoples faces that we using for the study",
      },
      value: "null",
      levels: [
        "<p style='text-align:center; font-size:80px;'>+</p>",
        "img/happy_face_1.jpg",
        "img/happy_face_2.jpg",
        "img/happy_face_3.jpg"
      ],
    }
    jsPsych.metadata.setVariable(stimulus_var);

    const stimulus_updated = jsPsych.metadata.getVariable("Stimulus");
    stimulus_updated["name"] = "stimulus_updated";
    stimulus_updated["levels"].push("img/test.jpg"); // pushing to levels
    Object.assign(stimulus_updated["description"], {"<h1>TestingTESTING</h1>": "shock factor"});


    jsPsych.run([preload, node]);

  </script>
</html>
